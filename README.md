# DVCS_ep

This repository contains scripts for running a DVCS analysis on files created by the ePIC collaboration's `EICrecon` software.

## Prerequisites

In order to use the code contained here, `eic-shell` must be installed on whatever system is being used run the analysis. If this is being run internally to the University of Glasgow's NHP group, `eic-shell` comes pre-loaded on some of our server systems (with the exception of `np-sigma`), and the farm nodes.

## Running an analysis

### File lists

The first step to running this analysis is to create a list of files which the main analysis code can run over. If the `EICrecon` output files (with the extension `.eicrecon.tree.edm4eic.root`) have been downloaded onto local storage, this can be done in whatever way the user feels easiest. Such lists should be stored in the directory `/filelists/`. The main analysis is also written to stream its input files from the Jefferson Lab workdisks - the script `getFileList.sh` is used to automatically create a file list from the ePIC monthly analysis campaigns, depending on desired settings.

The command line syntax for running this automatic file list script is as follows.

```
eic-shell
./getFileList.sh -b XXX -c XXX -e XXX
```

Here, the options `-b`, `-c` and `-e` reflect the desired beam geometry setting, campaign identifier and beam energy setting, respectively. The valid inputs for these parameters are as follows:
- `-b`: "hiAcc" or "hiDiv" for the high acceptance (lower luminosity, narrower at the Roman Pots) and high divergence (higher luminosity, wider at the Roman Pots) settings
- `-c`: YY.MM.N (eg. 23.11.0, 24.06.0), where YY is the year that the campaign was run, MM is the month that the campaign was run, and N is the campaign post-identifier number (typically "0" - check the campaign output directories for exact details)
- `-e`: "5x41", "10x100", "18x275"

These options can be specified in any order, and running the script without any options provides a help screen.

### Main analysis

The macro `run_ePIC_DVCS.C` is used to run the analysis contained within the user-defined `ePIC_DVCS_TASK` class. Within the run macro, the following is set:
- the location for the file list used as input for the analysis
- the location for the analysis output `.root` file, which stores all of the histograms generated by the analysis
- various kinematic cut values (such as a minimum Q^2^, or a maximum allowed missing energy in the full final state)

To run this macro at the command line, the syntax is

```
root 'run_ePIC_DVCS.C("Campaign","Energy","BeamSetting")'
```

If the listed beam setting is something other than "hiAcc" or "hiDiv", the analysis assumes that the user is not running with the automated simulation campaign filelists generated by `getFileLists.sh`, and uses a pre-defined "standard" filelist. This can be changed at the beginning of the `ePIC_DVCS_TASK::doAnalysis()` function.

### Plotting

The code provided in `DVCSPlots.C` is used to plot the histograms generated by the main analysis code, store them as PDFs, and combine them into a single file for ease of use. It is run in the same way as the main analysis:

```
root `DVCSPlots.C("Campaign","Energy","BeamSetting")
```

==Before running this for the first time==, new users should make sure that the location of the input ROOT files to the plotting macro is the same as where the main analysis is storing them.

## Automatic running of the analysis

The script `runAnalysis.sh` is provided to automatically run the DVCS analysis code from the ePIC simulation campaign output, and plot the results generated. It takes as input the simulation campaign number, beam energy and beam divergence settings - as for the file list script - and is run in the same way from within `eic-shell`:

```
eic-shell
./runAnalysis.sh -b "hiAcc/hiDiv" -c "YY.MM.N" -e "5x41/10x100/18x275"
```